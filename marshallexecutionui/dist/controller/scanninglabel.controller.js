sap.ui.define(["sap/ui/core/mvc/Controller","sap/ndc/BarcodeScanner","sap/m/MessageToast","sap/m/MessageBox"],(e,a,t,n)=>{"use strict";return e.extend("com.sysco.wm.marshallexecutionui.marshallexecutionui.controller.scanninglabel",{onInit(){var e=this.getOwnerComponent().getManifestEntry("/sap.app/id");var a=e.replaceAll(".","/");this.appModulePath=jQuery.sap.getModulePath(a);var t=this.getOwnerComponent().getRouter();this.oBundle=this.getOwnerComponent().getModel("i18n").getResourceBundle();this.getOwnerComponent().getRouter().getRoute("scanninglabel").attachPatternMatched(this._onRouteMatched,this)},_onRouteMatched:function(){this.getView().byId("inCageID").setValue()},navBack:function(){sap.ui.core.UIComponent.getRouterFor(this).navTo("Routescanlabel")},onScanSuccess:function(e){var a=this.getView().getModel("i18n").getResourceBundle();var n=a.getText("scanCancelled");if(e.getParameter("cancelled")){t.show(n,{duration:1e3})}else{if(e.getParameter("text")){var o=this.getView().byId("inCageID");o.setValue(e.getParameter("text"));o.fireSubmit()}}},onScanFail:function(e){n.show("Scan failed: "+e.getParameter("message"))},onLabelInput:function(e){var a=this.getOwnerComponent().getManifestEntry("/sap.app/id");var n=a.replaceAll(".","/");this.appModulePath=jQuery.sap.getModulePath(n);var o=sap.ui.getCore().getConfiguration().getLocale();var s=e.getParameter("value").trim().split("|")[0];var i=o.language;var r=this;var l="/marshallingservices";var c="/Marshalling/PickTaskHeaders?$filter=ID eq '"+s+"' and To_Marshalling/ID ne null and To_Marshalling/Status_ID ne 'PALLETISED'&$select=ID,Route,PickJob&$expand=To_Marshalling($expand=MarshallingBinID($select=ID,Description),SuggestedBinID($select=ID,Description)),Status,Media";var u=this.appModulePath+l+c;$.ajax({url:u,beforeSend:function(e){e.setRequestHeader("Accept-Language",i)},method:"GET",headers:{Accept:"application/json"},success:function(e){if(e.value.length>0){var a=new sap.ui.model.json.JSONModel(e.value);r.getOwnerComponent().setModel(a,"oScannedLabelModel");sap.ui.core.UIComponent.getRouterFor(r).navTo("scanpallet",{pickTaskID:s})}else{t.show(r.oBundle.getText("labelNotFound"))}},error:function(e,a){console.log("Error:",e,a)}})},_closeWrapDialogAccept:function(e){var a=this;if(this._oWrapDialogs){this._oWrapDialogs.close();var t=a.callConfirmMoves();n.information(a.oBundle.getText("lbl"),{actions:[sap.m.MessageBox.Action.OK],onClose:function(e){if(e===sap.m.MessageBox.Action.OK){sap.ui.core.UIComponent.getRouterFor(this).navTo("scanninglabel")}}.bind(a)})}},callConfirmMoves:function(){return new Promise((e,a)=>{var t=this;var n=sap.ui.getCore().getConfiguration().getLocale();var o=n.language;var s=this.appModulePath+"/marshallingservices/Marshalling/confirmMove";var i={IDs:[t._allData[0]]};$.ajax({url:s,beforeSend:function(e){e.setRequestHeader("Accept-Language",o)},method:"POST",contentType:"application/json",data:JSON.stringify(i),headers:{Accept:"application/json"},success:function(a){e(a.value)},error:function(e){a(e)}})})},_closeWrapDialogDecline:function(e){if(this._oWrapDialogs){this._oWrapDialogs.close()}}})});
//# sourceMappingURL=scanninglabel.controller.js.map