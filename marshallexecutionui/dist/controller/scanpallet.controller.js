sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageBox"],(e,a)=>{"use strict";return e.extend("com.sysco.wm.marshallexecutionui.marshallexecutionui.controller.scanpallet",{onInit(){this.getOwnerComponent().getRouter().getRoute("scanpallet").attachPatternMatched(this._onRouteMatched,this);this.oBundle=this.getOwnerComponent().getModel("i18n").getResourceBundle()},_onRouteMatched:function(e){var a=this.getOwnerComponent().getManifestEntry("/sap.app/id");var t=a.replaceAll(".","/");this.appModulePath=jQuery.sap.getModulePath(t);var s=this.getOwnerComponent().getRouter();this.oBundle=this.getOwnerComponent().getModel("i18n").getResourceBundle();this.getView().byId("scanPalMovePalID1").setEnabled(true);this.getView().byId("scanPalMoveID1").setEnabled(true);this.getView().byId("scanPalMoveID1").setValue();this.getView().byId("scanPalMoveID1").setValueState("None");this.getView().byId("scanPalMovePalID1").setValue();this.getView().byId("scanPalMovePalID1").setValueState("None");this.getView().byId("scanPalMoveRoute1").setValue();this.getView().byId("scanPalMoveConsoRoute1").setValue();this.getView().byId("scanPalMoveSrc1").setValue();this.getView().byId("scanPalMoveDest1").setValue();var o=e.getParameter("arguments").pickTaskID;if(o){this.setPickTaskData()}},setPickTaskData:function(){var e=this.getOwnerComponent().getModel("oScannedLabelModel").getData();this.val=e[0]?.To_Marshalling?.ID||"";console.log(e);this.getView().byId("scanPalMoveID1").setValue(e[0].To_Marshalling.CageID||"");this.getView().byId("scanPalMovePalID1").setValue(e[0].To_Marshalling.PalletID||"");this.getView().byId("scanPalMoveRoute1").setValue(e[0]?.Route||"");this.getView().byId("scanPalMoveConsoRoute1").setValue(e[0]?.To_Marshalling?.Route||"");this.getView().byId("scanPalMoveSrc1").setValue(e[0]?.To_Marshalling?.MarshallingBinID?.Description||"");this.getView().byId("scanPalMoveDest1").setValue(e[0]?.To_Marshalling?.SuggestedBinID?.Description||"")},onConfirmMove:function(e){var a=this.getView();if(!this._oWrapDialogs){this._oWrapDialogs=sap.ui.xmlfragment(a.getId(),"com.sysco.wm.marshallexecutionui.marshallexecutionui.fragment.wrapDialog",this);a.addDependent(this._oWrapDialogs)}this._oWrapDialogs.open()},_closeWrapDialogAccept:function(e){var t=this;if(this._oWrapDialogs){this._oWrapDialogs.close();var s=t.callConfirmMoves();a.information(t.oBundle.getText("lbl"),{actions:[sap.m.MessageBox.Action.OK],onClose:function(e){if(e===sap.m.MessageBox.Action.OK){sap.ui.core.UIComponent.getRouterFor(this).navTo("Routescanlabel")}}.bind(t)})}},callConfirmMoves:function(){return new Promise((e,a)=>{var t=this;var s=sap.ui.getCore().getConfiguration().getLocale();var o=s.language;var i=this.appModulePath+"/marshallingservices/Marshalling/confirmMove";var n={IDs:[t.val]};$.ajax({url:i,beforeSend:function(e){e.setRequestHeader("Accept-Language",o)},method:"POST",contentType:"application/json",data:JSON.stringify(n),headers:{Accept:"application/json"},success:function(a){e(a.value)},error:function(e){a(e)}})})},_closeWrapDialogDecline:function(e){if(this._oWrapDialogs){this._oWrapDialogs.close()}},bindCageData:function(){var e=this.getOwnerComponent().getModel("oScannedCageModel").getData();this.oData=e.value;this.getView().byId("scanPalMovePalID1").setValue();this.getView().byId("scanPalMoveID1").setValueState("None");if(this.oData.length===0){a.error(this.oBundle.getText("enter_correct_cage"));this.getView().byId("scanPalMoveID1").setValueState("Error");this.getView().byId("scanPalMoveRoute1").setValue();this.getView().byId("scanPalMoveConsoRoute1").setValue();this.getView().byId("scanPalMoveSrc1").setValue();this.getView().byId("scanPalMoveDest1").setValue();return}this.val=this.oData[0]?.To_Marshalling?.ID||"";var t=new sap.ui.model.json.JSONModel(this.oData);this.getView().setModel(t,"scanPalMove1");this.getView().byId("scanPalMoveRoute1").setValue(this.oData[0]?.Route||"");this.getView().byId("scanPalMoveConsoRoute1").setValue(this.oData[0]?.To_Marshalling?.Route||"");this.getView().byId("scanPalMoveSrc1").setValue(this.oData[0]?.To_Marshalling?.MarshallingBinID?.Description||"");this.getView().byId("scanPalMoveDest1").setValue(this.oData[0]?.To_Marshalling?.SuggestedBinID?.Description||"")},onCageIDInput:function(e){var a=this.getOwnerComponent().getManifestEntry("/sap.app/id");var t=a.replaceAll(".","/");this.appModulePath=jQuery.sap.getModulePath(t);var s=sap.ui.getCore().getConfiguration().getLocale();var o=e.getParameter("value").trim();var i=s.language;var n=this;var l="/marshallingservices";var r="/Marshalling/PickTaskHeaders?$filter=CageID eq '"+o+"' and To_Marshalling/ID ne null and To_Marshalling/Status_ID ne 'PALLETISED'&$select=ID,Route,PickJob&$expand=To_Marshalling($expand=MarshallingBinID($select=ID,Description),SuggestedBinID($select=ID,Description)),Status,Media";var g=this.appModulePath+l+r;$.ajax({url:g,beforeSend:function(e){e.setRequestHeader("Accept-Language",i)},method:"GET",headers:{Accept:"application/json"},success:function(e){var a=new sap.ui.model.json.JSONModel(e);n.getOwnerComponent().setModel(a,"oScannedCageModel");n.bindCageData()},error:function(e,a){console.log("Error:",e,a)}})},bindPalletData:function(e){var t=this.getOwnerComponent().getModel("oScannedPalletModel").getData();this.oData=t.value;this.getView().byId("scanPalMoveID1").setValue();this.getView().byId("scanPalMovePalID1").setValueState("None");if(this.oData.length===0){a.error(this.oBundle.getText("enter_correct_cage"));this.getView().byId("scanPalMovePalID1").setValueState("Error");this.getView().byId("scanPalMoveRoute1").setValue();this.getView().byId("scanPalMoveConsoRoute1").setValue();this.getView().byId("scanPalMoveSrc1").setValue();this.getView().byId("scanPalMoveDest1").setValue();return}this.val=this.oData[0]?.To_Marshalling?.ID||"";var s=new sap.ui.model.json.JSONModel(this.oData);this.getView().setModel(s,"scanPalMove1");this.getView().byId("scanPalMoveRoute1").setValue(this.oData[0]?.Route||"");this.getView().byId("scanPalMoveConsoRoute1").setValue(this.oData[0]?.To_Marshalling?.Route||"");this.getView().byId("scanPalMoveSrc1").setValue(this.oData[0]?.To_Marshalling?.MarshallingBinID?.Description||"");this.getView().byId("scanPalMoveDest1").setValue(this.oData[0]?.To_Marshalling?.SuggestedBinID?.Description||"")},onPalletIDInput:function(e){var a=this.getOwnerComponent().getManifestEntry("/sap.app/id");var t=a.replaceAll(".","/");this.appModulePath=jQuery.sap.getModulePath(t);var s=sap.ui.getCore().getConfiguration().getLocale();var o=e.getParameter("value").trim();var i=s.language;var n=this;var l="/marshallingservices";var r="/Marshalling/PickTaskHeaders?$filter=PalletID eq '"+o+"' and To_Marshalling/ID ne null and To_Marshalling/Status_ID ne 'PALLETISED'&$select=ID,Route,PickJob&$expand=To_Marshalling($expand=MarshallingBinID($select=ID,Description),SuggestedBinID($select=ID,Description)),Status,Media";var g=this.appModulePath+l+r;$.ajax({url:g,beforeSend:function(e){e.setRequestHeader("Accept-Language",i)},method:"GET",headers:{Accept:"application/json"},success:function(e){var a=new sap.ui.model.json.JSONModel(e);n.getOwnerComponent().setModel(a,"oScannedPalletModel");n.bindPalletData()},error:function(e,a){console.log("Error:",e,a)}})}})});
//# sourceMappingURL=scanpallet.controller.js.map